\hypertarget{Spline_8h_source}{}\doxysection{Spline.\+h}
\label{Spline_8h_source}\index{include/math/numerics/analysis/Spline.h@{include/math/numerics/analysis/Spline.h}}
\mbox{\hyperlink{Spline_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}../../Matrix.h"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}../utils.h"{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{gaussSeidel_8h}{math/numerics/lin\_alg/gaussSeidel.h}}>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{20 \textcolor{keyword}{class }\mbox{\hyperlink{classSpline}{Spline}}}
\DoxyCodeLine{21 \{}
\DoxyCodeLine{23   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}};}
\DoxyCodeLine{25   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}};}
\DoxyCodeLine{27   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_a397d8dba46f9e602ad7115719aa912f6}{ZI}};}
\DoxyCodeLine{29   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_a5e906d09d287cdee484389ca7e08a128}{Tx}};}
\DoxyCodeLine{31   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_aaaab7d2f16a8d4fb98d75576eccd56d0}{Ty}};}
\DoxyCodeLine{33   \textcolor{keywordtype}{bool} \mbox{\hyperlink{classSpline_ad4e25b6cb7ad208568ddaee957d76c29}{isEquidistant}} = \textcolor{keyword}{true};}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{public}:}
\DoxyCodeLine{41   \mbox{\hyperlink{classSpline_abdfa308c29717afc26e55319f30f837b}{Spline}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& X, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& Y) \{}
\DoxyCodeLine{42     \textcolor{keywordtype}{bool} isRows = X.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > X.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}();}
\DoxyCodeLine{43     \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}          = isRows ? X : X.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{44     \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}          = isRows ? Y : Y.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{45     \textcolor{keywordtype}{double} h    = fabs(\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(1, 0) -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(0, 0));}
\DoxyCodeLine{46     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() -\/ 1; ++i) \{}
\DoxyCodeLine{47       \textcolor{keyword}{auto} dist = fabs(\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(i + 1, 0) -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(i, 0));}
\DoxyCodeLine{48       \textcolor{keywordflow}{if}((dist -\/ h) > \mbox{\hyperlink{numerics_2utils_8h_a6ebf6899d6c1c8b7b9d09be872c05aae}{EPS}}) \{ \mbox{\hyperlink{classSpline_ad4e25b6cb7ad208568ddaee957d76c29}{isEquidistant}} = \textcolor{keyword}{false}; \}}
\DoxyCodeLine{49     \}}
\DoxyCodeLine{50   \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{58   \mbox{\hyperlink{classSpline_a2b37f086957c486fd85a51350f0aed4e}{Spline}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& X, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& Y, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& Z) \{}
\DoxyCodeLine{59     \textcolor{keywordtype}{bool} isRows = X.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > X.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}();}
\DoxyCodeLine{60     \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}          = isRows ? X : X.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{61     \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}          = isRows ? Y : Y.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{62     \mbox{\hyperlink{classSpline_a397d8dba46f9e602ad7115719aa912f6}{ZI}}          = isRows ? Z : Z.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{63     \textcolor{keywordtype}{double} h    = fabs(\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(1, 0) -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(0, 0));}
\DoxyCodeLine{64     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() -\/ 1; ++i) \{}
\DoxyCodeLine{65       \textcolor{keyword}{auto} dist = fabs(\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(i + 1, 0) -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(i, 0));}
\DoxyCodeLine{66       \textcolor{keywordflow}{if}((dist -\/ h) > \mbox{\hyperlink{numerics_2utils_8h_a6ebf6899d6c1c8b7b9d09be872c05aae}{EPS}}) \{ \mbox{\hyperlink{classSpline_ad4e25b6cb7ad208568ddaee957d76c29}{isEquidistant}} = \textcolor{keyword}{false}; \}}
\DoxyCodeLine{67     \}}
\DoxyCodeLine{68   \}}
\DoxyCodeLine{73   \textcolor{keywordtype}{double} \mbox{\hyperlink{classSpline_a239567877be8316c97f232161245fc2d}{eval\_spline\_j}}(\textcolor{keywordtype}{double} x\_act, \textcolor{keywordtype}{size\_t} j, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& mi) \{}
\DoxyCodeLine{74     \textcolor{keyword}{auto} h = \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j + 1, 0) -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j, 0);}
\DoxyCodeLine{75     \textcolor{keywordflow}{return} ((mi(j, 0) * \mbox{\hyperlink{Probability_8h_a4f0f49581ae9315695fb32a1e9fc4bdc}{pow}}((\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j + 1, 0) -\/ x\_act), 3.0) + mi(j + 1, 0) * \mbox{\hyperlink{Probability_8h_a4f0f49581ae9315695fb32a1e9fc4bdc}{pow}}((x\_act -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j, 0)), 3.0)) / 6.0) / h}
\DoxyCodeLine{76            + (\mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}(j, 0) * (\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j + 1, 0) -\/ x\_act) + \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}(j + 1, 0) * (x\_act -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j, 0))) / h}
\DoxyCodeLine{77            -\/ ((mi(j, 0) * (\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j + 1, 0) -\/ x\_act) + mi(j + 1, 0) * (x\_act -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j, 0))) * h) / 6.0;}
\DoxyCodeLine{78   \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{85   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_a2603cfc14f821d936f3a68cff8d4dcf0}{curv}}(\textcolor{keywordtype}{double} h) \{}
\DoxyCodeLine{86     \textcolor{keyword}{auto} mi  = \mbox{\hyperlink{numerics_2utils_8h_af5994908a659705a385de5bee89039fc}{zeros}}(\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}(), \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}());}
\DoxyCodeLine{87     \textcolor{keyword}{auto} dim = \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() -\/ 2;}
\DoxyCodeLine{88     \textcolor{keyword}{auto} rhs = 6.0 / (h * h) * (\mbox{\hyperlink{numerics_2utils_8h_aa7eb7984fa32d548f6a24b4d440c919a}{tridiag}}(dim, dim, 1, -\/2, 1) * \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}.\mbox{\hyperlink{classMatrix_a74deba042f505ff0640028b07c20778e}{GetSlice}}(1, \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() -\/ 2, 0, \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}() -\/ 1));}
\DoxyCodeLine{89     \textcolor{keyword}{auto} lhs = \mbox{\hyperlink{numerics_2utils_8h_aa7eb7984fa32d548f6a24b4d440c919a}{tridiag}}(dim, dim, 1, 4, 1);}
\DoxyCodeLine{90     \textcolor{keyword}{auto} res = \mbox{\hyperlink{gaussSeidel_8h_a7bb1e3f545d858ee2a450500c711f471}{gaussSeidel}}(lhs, rhs);}
\DoxyCodeLine{91     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < res.rows(); ++i) \{ mi(i + 1, 0) = res(i, 0); \}}
\DoxyCodeLine{92     \textcolor{keywordflow}{return} mi;}
\DoxyCodeLine{93   \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{100   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSpline_a8c6b5b07aba1be33e8c33d4041212121}{SetAbstractionValue}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& tx, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& ty) \{}
\DoxyCodeLine{101     \mbox{\hyperlink{classSpline_a5e906d09d287cdee484389ca7e08a128}{Tx}} = tx;}
\DoxyCodeLine{102     \mbox{\hyperlink{classSpline_aaaab7d2f16a8d4fb98d75576eccd56d0}{Ty}} = ty;}
\DoxyCodeLine{103   \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{110   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_a6c786781622f0e13589e01848a959467}{operator()}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& xi) \{}
\DoxyCodeLine{111     \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSpline_ad4e25b6cb7ad208568ddaee957d76c29}{isEquidistant}} \&\& \mbox{\hyperlink{classSpline_a397d8dba46f9e602ad7115719aa912f6}{ZI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() == 0) \textcolor{keywordflow}{return} \mbox{\hyperlink{classSpline_a1363e5a90e0c3571f662d2c9b82934c6}{calculateEquidistant}}(xi);}
\DoxyCodeLine{112     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{113       \mbox{\hyperlink{classMatrix}{Matrix<double>}} ti;}
\DoxyCodeLine{114       \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSpline_a5e906d09d287cdee484389ca7e08a128}{Tx}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > 0) \{}
\DoxyCodeLine{115         ti = \mbox{\hyperlink{classSpline_a5e906d09d287cdee484389ca7e08a128}{Tx}};}
\DoxyCodeLine{116       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{117         ti = \mbox{\hyperlink{numerics_2utils_8h_af9dcfd52b7832ac134ae73f568a90350}{linspace}}(\mbox{\hyperlink{Matrix_8h_a4bb73e4029612f323f406f1ecfc2ed57}{min}}(xi), \mbox{\hyperlink{Matrix_8h_a8dd66fbac5097923b2ecf481b0ae77e5}{max}}(xi), \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}()).\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{118       \}}
\DoxyCodeLine{119       \textcolor{keyword}{auto} s = \mbox{\hyperlink{classSpline}{Spline}}(ti, \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}})(xi);}
\DoxyCodeLine{120 }
\DoxyCodeLine{121       \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > 0) \{ s = s.HorizontalConcat(\mbox{\hyperlink{classSpline}{Spline}}(ti, \mbox{\hyperlink{classSpline_ad89c7a69b3b12323fb7068e32b90f645}{YI}})(xi)); \}}
\DoxyCodeLine{122       \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSpline_a397d8dba46f9e602ad7115719aa912f6}{ZI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > 0) \{ s = s.HorizontalConcat(\mbox{\hyperlink{classSpline}{Spline}}(ti, \mbox{\hyperlink{classSpline_a397d8dba46f9e602ad7115719aa912f6}{ZI}})(xi)); \}}
\DoxyCodeLine{123       \textcolor{keywordflow}{return} s;}
\DoxyCodeLine{124     \}}
\DoxyCodeLine{125   \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{132   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classSpline_a1363e5a90e0c3571f662d2c9b82934c6}{calculateEquidistant}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& xi) \{}
\DoxyCodeLine{133     \textcolor{keyword}{auto} innerXI = xi.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > xi.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}() ? xi : xi.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}();}
\DoxyCodeLine{134     \textcolor{keyword}{auto} mi      = \mbox{\hyperlink{classSpline_a2603cfc14f821d936f3a68cff8d4dcf0}{curv}}(\mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(1, 0) -\/ \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(0, 0));}
\DoxyCodeLine{135     \textcolor{keyword}{auto} y       = \mbox{\hyperlink{numerics_2utils_8h_af5994908a659705a385de5bee89039fc}{zeros}}(innerXI.rows(), innerXI.columns());}
\DoxyCodeLine{136     \textcolor{comment}{// Elementwise evaluate splines, for all}}
\DoxyCodeLine{137     \textcolor{comment}{// elements xi with i = 0, ..., n-\/1}}
\DoxyCodeLine{138     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} j = 0; j < \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() -\/ 1; ++j) \{}
\DoxyCodeLine{139       \textcolor{comment}{// all elements x, between x\_j and x\_\{j+1\}}}
\DoxyCodeLine{140       \textcolor{keyword}{auto} xl  = \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j, 0);}
\DoxyCodeLine{141       \textcolor{keyword}{auto} xr  = \mbox{\hyperlink{classSpline_aec3e4ba42a25a84af7b30e9a93a34548}{XI}}(j + 1, 0);}
\DoxyCodeLine{142       \textcolor{keyword}{auto} ind = \mbox{\hyperlink{numerics_2utils_8h_a7f1911548355817103d492232e6eaa8d}{nonzero}}([xl, xr](\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& x) \{ \textcolor{keywordflow}{return} bool((xl <= x) \&\& (x <= xr)); \}, innerXI).Transpose();}
\DoxyCodeLine{143       \textcolor{comment}{// evaluate using the j-\/th spline}}
\DoxyCodeLine{144       \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < ind.rows(); ++i) \{ y(ind(i, 0), 0) += \mbox{\hyperlink{classSpline_a239567877be8316c97f232161245fc2d}{eval\_spline\_j}}(innerXI(ind(i, 0), 0), j, mi); \}}
\DoxyCodeLine{145     \}}
\DoxyCodeLine{146     \textcolor{keywordflow}{return} y;}
\DoxyCodeLine{147   \}}
\DoxyCodeLine{148 \};}
\DoxyCodeLine{149 }

\end{DoxyCode}

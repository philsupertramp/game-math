\hypertarget{DecisionTree_8h_source}{}\doxysection{Decision\+Tree.\+h}
\label{DecisionTree_8h_source}\index{include/math/ds/DecisionTree.h@{include/math/ds/DecisionTree.h}}
\mbox{\hyperlink{DecisionTree_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include "{}../Matrix.h"{}}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}../numerics/utils.h"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{Predictor_8h}{Predictor.h}}"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{enum} \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79}{ImpurityMeasure}} \{ \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79ad2eb5b71c558f69f6087faa8aa6d2f36}{ENTROPY}} = 0, \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79ad98fff1a06cd7c914cb9c4776045a6c2}{GINI}} = 1 \};}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* \mbox{\hyperlink{DecisionTree_8h_a8924d32b66e3d6d5ad60477dbb332eb4}{measure\_to\_name}}(\mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79}{ImpurityMeasure}} measure) \{}
\DoxyCodeLine{12   \textcolor{keywordflow}{switch}(measure) \{}
\DoxyCodeLine{13     \textcolor{keywordflow}{case} \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79ad2eb5b71c558f69f6087faa8aa6d2f36}{ImpurityMeasure::ENTROPY}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}entropy"{}};}
\DoxyCodeLine{14     \textcolor{keywordflow}{case} \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79ad98fff1a06cd7c914cb9c4776045a6c2}{ImpurityMeasure::GINI}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}gini"{}};}
\DoxyCodeLine{15     \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}unknown"{}};}
\DoxyCodeLine{16   \}}
\DoxyCodeLine{17 \}}
\DoxyCodeLine{18 \textcolor{comment}{/*}}
\DoxyCodeLine{19 \textcolor{comment}{ def entropy(s):}}
\DoxyCodeLine{20 \textcolor{comment}{    counts = np.bincount(np.array(s, dtype=np.int64))}}
\DoxyCodeLine{21 \textcolor{comment}{    percentages = counts / len(s)}}
\DoxyCodeLine{22 \textcolor{comment}{    entropy = 0}}
\DoxyCodeLine{23 \textcolor{comment}{    for pct in percentages:}}
\DoxyCodeLine{24 \textcolor{comment}{        if pct > 0:}}
\DoxyCodeLine{25 \textcolor{comment}{            entropy += pct*np.log2(pct)}}
\DoxyCodeLine{26 \textcolor{comment}{    return -\/entropy}}
\DoxyCodeLine{27 \textcolor{comment}{ */}}
\DoxyCodeLine{28 \textcolor{keywordtype}{double} \mbox{\hyperlink{DecisionTree_8h_a328ab44cf2143d23b45c83534e36dc51}{entropy}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& in) \{}
\DoxyCodeLine{29   \textcolor{keyword}{auto} unique\_values = \mbox{\hyperlink{matrix__utils_8h_af79386365c3901ef0bec8f116368ded2}{unique}}(in);}
\DoxyCodeLine{30   \textcolor{comment}{// TODO: Implement log2 to implement entropy... sadge}}
\DoxyCodeLine{31   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{32 \}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{DecisionTree_8h_ad071de4aa96571b2d3d4dc1e07211633}{count\_bins}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& in) \{}
\DoxyCodeLine{35   \textcolor{keyword}{auto} unique\_values = \mbox{\hyperlink{sorting_8h_ad3d28c133882ced8b95545bb5fba55d0}{sort}}(\mbox{\hyperlink{matrix__utils_8h_af79386365c3901ef0bec8f116368ded2}{unique}}(in.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() > in.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}() ? in : in.\mbox{\hyperlink{classMatrix_a054a03bcae4eb86d6f4ef84dc87840ef}{Transpose}}()));}
\DoxyCodeLine{36   \textcolor{keyword}{auto} bins          = \mbox{\hyperlink{numerics_2utils_8h_af5994908a659705a385de5bee89039fc}{zeros}}(unique\_values.rows(), 2);}
\DoxyCodeLine{37   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < unique\_values.rows(); ++i) \{}
\DoxyCodeLine{38     \textcolor{keyword}{auto} label                       = unique\_values(i, 0);}
\DoxyCodeLine{39     std::function<bool(\textcolor{keywordtype}{double})> cond = [label](\textcolor{keywordtype}{double} xi) \{ \textcolor{keywordflow}{return} bool(xi == label); \};}
\DoxyCodeLine{40     bins(i, 0) = label;}
\DoxyCodeLine{41     bins(i, 1)                       = \mbox{\hyperlink{matrix__utils_8h_a06d4149d83f11dbd6ae1ea8a51cdfa12}{where\_true}}(\mbox{\hyperlink{matrix__utils_8h_afb3f7de2743f10b710460feb9c0f9009}{where}}(cond, in, \{ \{ 1 \} \}, \{ \{ 0 \} \})).elements\_total();}
\DoxyCodeLine{42   \}}
\DoxyCodeLine{43   \textcolor{keywordflow}{return} bins;}
\DoxyCodeLine{44 \}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{comment}{/*}}
\DoxyCodeLine{47 \textcolor{comment}{}}
\DoxyCodeLine{48 \textcolor{comment}{ def gini\_impurity(s):}}
\DoxyCodeLine{49 \textcolor{comment}{    counts = np.bincount(np.array(s, dtype=np.int64))}}
\DoxyCodeLine{50 \textcolor{comment}{    percentages = counts / len(s)}}
\DoxyCodeLine{51 \textcolor{comment}{    return 1 -\/ (percentages**2).sum()}}
\DoxyCodeLine{52 \textcolor{comment}{ */}}
\DoxyCodeLine{53 \textcolor{keywordtype}{double} \mbox{\hyperlink{DecisionTree_8h_ad2f2963dddf5d8c176992a23aedc3092}{gini}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& in) \{}
\DoxyCodeLine{54   \textcolor{keyword}{auto} bins = \mbox{\hyperlink{DecisionTree_8h_ad071de4aa96571b2d3d4dc1e07211633}{count\_bins}}(in);}
\DoxyCodeLine{55   bins = bins.GetSlice(0,bins.rows()-\/1,1,1);}
\DoxyCodeLine{56   \textcolor{keyword}{auto} pct  = ((1.0 / (double)in.\mbox{\hyperlink{classMatrix_a3fd198fedce7d0e4e33ae6d8b589b8f8}{elements\_total}}()) * bins).Apply([](\textcolor{keywordtype}{double} xi)\{\textcolor{keywordflow}{return} xi * xi;\});}
\DoxyCodeLine{57   \textcolor{keywordflow}{return} 1.0 -\/ pct.sumElements();}
\DoxyCodeLine{58 \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{keyword}{enum} \mbox{\hyperlink{DecisionTree_8h_aa7e8eeb6e645374f861a868ea569d360}{DecisionNodeType}} \{ \mbox{\hyperlink{DecisionTree_8h_aa7e8eeb6e645374f861a868ea569d360ac157bdf0b85a40d2619cbc8bc1ae5fe2}{NONE}} = -\/1, \mbox{\hyperlink{DecisionTree_8h_aa7e8eeb6e645374f861a868ea569d360a150d9833918207030adb030ccc759c20}{LEAF}} = 0, \mbox{\hyperlink{DecisionTree_8h_aa7e8eeb6e645374f861a868ea569d360a0d31cd90b1053f89cbae83cfc8b2ed4e}{DECISION}} = 1 \};}
\DoxyCodeLine{61 }
\DoxyCodeLine{70 \textcolor{keyword}{class }\mbox{\hyperlink{classDecisionNode}{DecisionNode}}}
\DoxyCodeLine{71 \{}
\DoxyCodeLine{72 \textcolor{keyword}{public}:}
\DoxyCodeLine{73   \textcolor{comment}{// Leaf node}}
\DoxyCodeLine{74   \textcolor{keywordtype}{double} \mbox{\hyperlink{classDecisionNode_a33261e7ae7ff313fe71885a887abf8c7}{value}} = -\/1; \textcolor{comment}{// class label for leaf node}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{comment}{// Decision node}}
\DoxyCodeLine{77   \textcolor{keywordtype}{int} \mbox{\hyperlink{classDecisionNode_a4e872cb5e21b8b26bb122bfd8d23d878}{feature}}            = -\/1;}
\DoxyCodeLine{78   \textcolor{keywordtype}{double} \mbox{\hyperlink{classDecisionNode_a3c647d210ebc81ea45138d95b4ad759b}{threshold}}        = -\/1;}
\DoxyCodeLine{79   \textcolor{keywordtype}{double} \mbox{\hyperlink{classDecisionNode_a98a2a9c54818c864dea1e8b7f4dc2153}{information\_gain}} = -\/1;}
\DoxyCodeLine{80 }
\DoxyCodeLine{81   \mbox{\hyperlink{classDecisionNode}{DecisionNode}} *\mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}}, *\mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}};}
\DoxyCodeLine{82 }
\DoxyCodeLine{83   \textcolor{comment}{// general}}
\DoxyCodeLine{84   \mbox{\hyperlink{DecisionTree_8h_aa7e8eeb6e645374f861a868ea569d360}{DecisionNodeType}} \mbox{\hyperlink{classDecisionNode_aefe3826544a26c8ac74bb735d2a9c867}{type}} = DecisionNodeType::NONE;}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{keyword}{public}:}
\DoxyCodeLine{87   \mbox{\hyperlink{classDecisionNode_a1b6aadd701a106ea0596806f3b0345d5}{DecisionNode}}() \{ \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   \mbox{\hyperlink{classDecisionNode_a58abd8501fc1f0cc4d6895eeea605c17}{DecisionNode}}(\textcolor{keywordtype}{double} val)}
\DoxyCodeLine{90     : \mbox{\hyperlink{classDecisionNode_a33261e7ae7ff313fe71885a887abf8c7}{value}}(val) \{}
\DoxyCodeLine{91     \mbox{\hyperlink{classDecisionNode_aefe3826544a26c8ac74bb735d2a9c867}{type}} = DecisionNodeType::LEAF;}
\DoxyCodeLine{92   \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \mbox{\hyperlink{classDecisionNode_a505bb5ac9db74e250341b0fda527bd12}{DecisionNode}}(\textcolor{keywordtype}{int} feat, \textcolor{keywordtype}{double} thresh, \textcolor{keywordtype}{double} ig, \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* \mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}}, \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* \mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}})}
\DoxyCodeLine{95     : \mbox{\hyperlink{classDecisionNode_a4e872cb5e21b8b26bb122bfd8d23d878}{feature}}(feat)}
\DoxyCodeLine{96     , \mbox{\hyperlink{classDecisionNode_a3c647d210ebc81ea45138d95b4ad759b}{threshold}}(thresh)}
\DoxyCodeLine{97     , \mbox{\hyperlink{classDecisionNode_a98a2a9c54818c864dea1e8b7f4dc2153}{information\_gain}}(ig)}
\DoxyCodeLine{98     , \mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}}(\mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}})}
\DoxyCodeLine{99     , \mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}}(\mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}}) \{}
\DoxyCodeLine{100     \mbox{\hyperlink{classDecisionNode_aefe3826544a26c8ac74bb735d2a9c867}{type}} = DecisionNodeType::DECISION;}
\DoxyCodeLine{101   \}}
\DoxyCodeLine{102 \};}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 }
\DoxyCodeLine{108 \textcolor{keyword}{struct }\mbox{\hyperlink{structDataSplit}{DataSplit}} \{}
\DoxyCodeLine{109   \textcolor{keywordtype}{int} \mbox{\hyperlink{structDataSplit_abd322cb1625c71ba89c9745b90383415}{feature}};}
\DoxyCodeLine{110   \textcolor{keywordtype}{double} \mbox{\hyperlink{structDataSplit_a9ca2b329a9bef76ce67ecbfb84322650}{threshold}};}
\DoxyCodeLine{111   \textcolor{keywordtype}{double} \mbox{\hyperlink{structDataSplit_a0f09d96e5a46a4b3e7aeaeb6243eb23d}{information\_gain}};}
\DoxyCodeLine{112   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{structDataSplit_ae69d3b2e680b6af0b003f51bd66386c2}{left\_split}};}
\DoxyCodeLine{113   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{structDataSplit_a99fdc1cb573d2c2df9e8999a89173c10}{right\_split}};}
\DoxyCodeLine{114 \} \mbox{\hyperlink{structDataSplit}{DataSplit}};}
\DoxyCodeLine{115 }
\DoxyCodeLine{129 \textcolor{keyword}{class }\mbox{\hyperlink{classDecisionTree}{DecisionTree}} : \textcolor{keyword}{public} \mbox{\hyperlink{classPredictor}{Predictor}}}
\DoxyCodeLine{130 \{}
\DoxyCodeLine{131   \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79}{ImpurityMeasure}} \mbox{\hyperlink{classDecisionTree_ac63504a08dc5485319f740609dff4604}{\_decision\_method}};}
\DoxyCodeLine{132   \textcolor{keywordtype}{int} \mbox{\hyperlink{classDecisionTree_abeb807ae76aa21e06a39b693aeed7310}{\_max\_depth}}             = 10;}
\DoxyCodeLine{133   \textcolor{keywordtype}{int} \mbox{\hyperlink{classDecisionTree_aac47d5728383a34fe42eb9e4fdf0ff83}{\_min\_samples\_per\_split}} = 2;}
\DoxyCodeLine{134   \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* \mbox{\hyperlink{classDecisionTree_af11dfd0fec8b8c40236b072fd43c10e6}{base\_node}};}
\DoxyCodeLine{135 }
\DoxyCodeLine{136 \textcolor{keyword}{public}:}
\DoxyCodeLine{137   \mbox{\hyperlink{classDecisionTree_af04b0eacf726e5ad4acb2a195c61aea6}{DecisionTree}}(}
\DoxyCodeLine{138   \textcolor{keywordtype}{int} min\_samples\_per\_split = 2, \textcolor{keywordtype}{int} max\_depth = 10, \mbox{\hyperlink{DecisionTree_8h_ad27b83d37741cc5afd32dab8738e4a79}{ImpurityMeasure}} decision\_method = ImpurityMeasure::GINI)}
\DoxyCodeLine{139     : \mbox{\hyperlink{classPredictor}{Predictor}}()}
\DoxyCodeLine{140     , \mbox{\hyperlink{classDecisionTree_ac63504a08dc5485319f740609dff4604}{\_decision\_method}}(decision\_method)}
\DoxyCodeLine{141     , \mbox{\hyperlink{classDecisionTree_aac47d5728383a34fe42eb9e4fdf0ff83}{\_min\_samples\_per\_split}}(min\_samples\_per\_split)}
\DoxyCodeLine{142     , \mbox{\hyperlink{classDecisionTree_abeb807ae76aa21e06a39b693aeed7310}{\_max\_depth}}(max\_depth) \{ \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{144 }
\DoxyCodeLine{145   \textcolor{keywordtype}{double} \mbox{\hyperlink{classDecisionTree_ab5bdd809891b26afecb2906e51e56f3c}{impurity}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& x) \{}
\DoxyCodeLine{146     \textcolor{keywordflow}{switch}(\mbox{\hyperlink{classDecisionTree_ac63504a08dc5485319f740609dff4604}{\_decision\_method}}) \{}
\DoxyCodeLine{147       \textcolor{keywordflow}{case} ImpurityMeasure::ENTROPY: \textcolor{keywordflow}{return} \mbox{\hyperlink{DecisionTree_8h_a328ab44cf2143d23b45c83534e36dc51}{entropy}}(x);}
\DoxyCodeLine{148       \textcolor{keywordflow}{case} ImpurityMeasure::GINI: \textcolor{keywordflow}{return} \mbox{\hyperlink{DecisionTree_8h_ad2f2963dddf5d8c176992a23aedc3092}{gini}}(x);}
\DoxyCodeLine{149       \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{150     \}}
\DoxyCodeLine{151   \}}
\DoxyCodeLine{162   \textcolor{keywordtype}{double}}
\DoxyCodeLine{163   \mbox{\hyperlink{classDecisionTree_a70b5fdacbf9ac8757a02529721231e82}{information\_gain}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& parent, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& left\_child, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& right\_child) \{}
\DoxyCodeLine{164     \textcolor{keywordtype}{double} p\_left  = (double)left\_child.\mbox{\hyperlink{classMatrix_a3fd198fedce7d0e4e33ae6d8b589b8f8}{elements\_total}}() / parent.\mbox{\hyperlink{classMatrix_a3fd198fedce7d0e4e33ae6d8b589b8f8}{elements\_total}}();}
\DoxyCodeLine{165     \textcolor{keywordtype}{double} p\_right = (double)right\_child.\mbox{\hyperlink{classMatrix_a3fd198fedce7d0e4e33ae6d8b589b8f8}{elements\_total}}() / parent.\mbox{\hyperlink{classMatrix_a3fd198fedce7d0e4e33ae6d8b589b8f8}{elements\_total}}();}
\DoxyCodeLine{166     \textcolor{keywordflow}{return} \mbox{\hyperlink{classDecisionTree_ab5bdd809891b26afecb2906e51e56f3c}{impurity}}(parent) -\/ (p\_left * \mbox{\hyperlink{classDecisionTree_ab5bdd809891b26afecb2906e51e56f3c}{impurity}}(left\_child) + p\_right * \mbox{\hyperlink{classDecisionTree_ab5bdd809891b26afecb2906e51e56f3c}{impurity}}(right\_child));}
\DoxyCodeLine{167   \}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169   \textcolor{keyword}{struct }\mbox{\hyperlink{structDataSplit}{DataSplit}} \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}(const \mbox{\hyperlink{classMatrix}{Matrix}}<double>\& X, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& y) \{}
\DoxyCodeLine{170     \textcolor{keyword}{struct }\mbox{\hyperlink{structDataSplit}{DataSplit}} \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}} \{ \};}
\DoxyCodeLine{171     \textcolor{keywordtype}{double} best\_info\_gain = -\/1.;}
\DoxyCodeLine{172 }
\DoxyCodeLine{173     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} idf = 0; idf < X.columns(); ++idf) \{}
\DoxyCodeLine{174       \textcolor{keyword}{auto} eV       = \mbox{\hyperlink{numerics_2utils_8h_ae4d3442586cdfc0c5468be49ff561bcd}{zerosV}}(X.columns());}
\DoxyCodeLine{175       eV(idf, 0)    = 1;}
\DoxyCodeLine{176       \textcolor{keyword}{auto} features = X * eV;}
\DoxyCodeLine{177       \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} idx = 0; idx < features.rows(); ++idx) \{}
\DoxyCodeLine{178         \textcolor{keyword}{auto} df        = \mbox{\hyperlink{matrix__utils_8h_a1f9177b021b6f3a2ec3a4f0b26797b8e}{HorizontalConcat}}(X, y);}
\DoxyCodeLine{179         \textcolor{keyword}{auto} threshold = features(idx, 0);}
\DoxyCodeLine{180 }
\DoxyCodeLine{181         std::function<bool(\textcolor{keywordtype}{double})> cond = [threshold](\textcolor{keywordtype}{double} xi) \{ \textcolor{keywordflow}{return} bool(xi <= threshold); \};}
\DoxyCodeLine{182         \textcolor{keyword}{auto} split\_indices               = \mbox{\hyperlink{matrix__utils_8h_afb3f7de2743f10b710460feb9c0f9009}{where}}(cond, features, \{ \{ 1 \} \}, \{ \{ 0 \} \});}
\DoxyCodeLine{183         \textcolor{keyword}{auto} left\_indices                = \mbox{\hyperlink{matrix__utils_8h_a06d4149d83f11dbd6ae1ea8a51cdfa12}{where\_true}}(split\_indices);}
\DoxyCodeLine{184         \textcolor{keyword}{auto} right\_indices               = \mbox{\hyperlink{matrix__utils_8h_ad9e4f7e23e67730cd255288face8d8d3}{where\_false}}(split\_indices);}
\DoxyCodeLine{185         \textcolor{keywordflow}{if}(left\_indices.rows() > 0 \&\& right\_indices.rows() > 0) \{}
\DoxyCodeLine{186           \textcolor{keyword}{auto} left\_split  = df.GetSlicesByIndex(left\_indices);}
\DoxyCodeLine{187           \textcolor{keyword}{auto} right\_split = df.GetSlicesByIndex(right\_indices);}
\DoxyCodeLine{188           \textcolor{keyword}{auto} gain        = \mbox{\hyperlink{classDecisionTree_a70b5fdacbf9ac8757a02529721231e82}{information\_gain}}(}
\DoxyCodeLine{189           y,}
\DoxyCodeLine{190           left\_split.GetSlice(0, left\_split.rows() -\/ 1, left\_split.columns() -\/ 1),}
\DoxyCodeLine{191           right\_split.GetSlice(0, right\_split.rows() -\/ 1, right\_split.columns() -\/ 1));}
\DoxyCodeLine{192           \textcolor{keywordflow}{if}(gain > best\_info\_gain) \{}
\DoxyCodeLine{193             best\_info\_gain              = gain;}
\DoxyCodeLine{194             \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}.\mbox{\hyperlink{structDataSplit_a0f09d96e5a46a4b3e7aeaeb6243eb23d}{information\_gain}} = gain;}
\DoxyCodeLine{195             \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}.\mbox{\hyperlink{structDataSplit_abd322cb1625c71ba89c9745b90383415}{feature}}          = idf;}
\DoxyCodeLine{196             \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}.\mbox{\hyperlink{structDataSplit_a9ca2b329a9bef76ce67ecbfb84322650}{threshold}}        = threshold;}
\DoxyCodeLine{197             \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}.\mbox{\hyperlink{structDataSplit_ae69d3b2e680b6af0b003f51bd66386c2}{left\_split}}       = left\_split;}
\DoxyCodeLine{198             \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}.\mbox{\hyperlink{structDataSplit_a99fdc1cb573d2c2df9e8999a89173c10}{right\_split}}      = right\_split;}
\DoxyCodeLine{199           \}}
\DoxyCodeLine{200         \}}
\DoxyCodeLine{201       \}}
\DoxyCodeLine{202     \}}
\DoxyCodeLine{203     \textcolor{keywordflow}{return} \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}};}
\DoxyCodeLine{204   \}}
\DoxyCodeLine{205 }
\DoxyCodeLine{206 \textcolor{keyword}{private}:}
\DoxyCodeLine{219   \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* \mbox{\hyperlink{classDecisionTree_a821f49ab54e910f33941360a891b67fc}{build\_tree}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& X, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& y, \textcolor{keywordtype}{int} depth = 0) \{}
\DoxyCodeLine{220     \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* out = (\mbox{\hyperlink{classDecisionNode}{DecisionNode}}*)malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classDecisionNode}{DecisionNode}}));}
\DoxyCodeLine{221     \textcolor{keywordflow}{if}(X.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}() >= \mbox{\hyperlink{classDecisionTree_aac47d5728383a34fe42eb9e4fdf0ff83}{\_min\_samples\_per\_split}} \&\& depth < \mbox{\hyperlink{classDecisionTree_abeb807ae76aa21e06a39b693aeed7310}{\_max\_depth}}) \{}
\DoxyCodeLine{222       \textcolor{keyword}{auto} best = \mbox{\hyperlink{classDecisionTree_aae7f14b073a786531e6c09922f9880b4}{best\_split}}(X, y);}
\DoxyCodeLine{223       \textcolor{keywordflow}{if}(best.information\_gain > 0) \{}
\DoxyCodeLine{224         \textcolor{keyword}{auto} left = \mbox{\hyperlink{classDecisionTree_a821f49ab54e910f33941360a891b67fc}{build\_tree}}(}
\DoxyCodeLine{225         best.left\_split.GetSlice(0, best.left\_split.rows() -\/ 1, 0, best.left\_split.columns() -\/ 2),}
\DoxyCodeLine{226         best.left\_split.GetSlice(0, best.left\_split.rows() -\/ 1, best.left\_split.columns() -\/ 1),}
\DoxyCodeLine{227         depth + 1);}
\DoxyCodeLine{228         \textcolor{keyword}{auto} right = \mbox{\hyperlink{classDecisionTree_a821f49ab54e910f33941360a891b67fc}{build\_tree}}(}
\DoxyCodeLine{229         best.right\_split.GetSlice(0, best.right\_split.rows() -\/ 1, 0, best.right\_split.columns() -\/ 2),}
\DoxyCodeLine{230         best.right\_split.GetSlice(0, best.right\_split.rows() -\/ 1, best.right\_split.columns() -\/ 1),}
\DoxyCodeLine{231         depth + 1);}
\DoxyCodeLine{232 }
\DoxyCodeLine{233         out = \textcolor{keyword}{new} \mbox{\hyperlink{classDecisionNode}{DecisionNode}}(best.feature, best.threshold, best.information\_gain, left, right);}
\DoxyCodeLine{234         \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{235       \}}
\DoxyCodeLine{236     \}}
\DoxyCodeLine{237 }
\DoxyCodeLine{238     \textcolor{comment}{// found leaf node}}
\DoxyCodeLine{239     \textcolor{keyword}{auto} bins = \mbox{\hyperlink{DecisionTree_8h_ad071de4aa96571b2d3d4dc1e07211633}{count\_bins}}(y);}
\DoxyCodeLine{240     \textcolor{keyword}{auto} argmax\_value = bins(\mbox{\hyperlink{matrix__utils_8h_a2a01e8ac881ea58d279cd73ec1803444}{argmax}}(bins.GetSlice(0, bins.rows() -\/ 1, 1, 1)), 0);}
\DoxyCodeLine{241     out = \textcolor{keyword}{new} \mbox{\hyperlink{classDecisionNode}{DecisionNode}}(argmax\_value);}
\DoxyCodeLine{242     \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{243   \}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245 }
\DoxyCodeLine{253   \textcolor{keywordtype}{double} \mbox{\hyperlink{classDecisionTree_ad6d9caca64c5ff9d73e710e86b52ed46}{\_predict}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& x, \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* node) \{}
\DoxyCodeLine{254     \textcolor{keywordflow}{if}(node-\/>\mbox{\hyperlink{classDecisionNode_aefe3826544a26c8ac74bb735d2a9c867}{type}} == DecisionNodeType::LEAF) \{ \textcolor{keywordflow}{return} node-\/>\mbox{\hyperlink{classDecisionNode_a33261e7ae7ff313fe71885a887abf8c7}{value}}; \}}
\DoxyCodeLine{255     \textcolor{keywordflow}{if}(x(0, node-\/>\mbox{\hyperlink{classDecisionNode_a4e872cb5e21b8b26bb122bfd8d23d878}{feature}}) <= node-\/>\mbox{\hyperlink{classDecisionNode_a3c647d210ebc81ea45138d95b4ad759b}{threshold}}) \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classDecisionTree_ad6d9caca64c5ff9d73e710e86b52ed46}{\_predict}}(x, node-\/>\mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}}); \}}
\DoxyCodeLine{256     \textcolor{keywordflow}{return} \mbox{\hyperlink{classDecisionTree_ad6d9caca64c5ff9d73e710e86b52ed46}{\_predict}}(x, node-\/>\mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}});}
\DoxyCodeLine{257   \}}
\DoxyCodeLine{258 }
\DoxyCodeLine{259   \textcolor{keywordtype}{void} \mbox{\hyperlink{classDecisionTree_adb478af2bbf745ff208a4e666ef2b957}{render\_node}}(std::ostream\& ostr, \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* node, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* side, \textcolor{keywordtype}{int} depth)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{260     ostr << std::string(depth, \textcolor{charliteral}{'\(\backslash\)t'}) << side;}
\DoxyCodeLine{261     \textcolor{keywordflow}{if}(node-\/>\mbox{\hyperlink{classDecisionNode_aefe3826544a26c8ac74bb735d2a9c867}{type}} == DecisionNodeType::LEAF) \{}
\DoxyCodeLine{262       ostr << \textcolor{stringliteral}{"{}label = "{}} << node-\/>\mbox{\hyperlink{classDecisionNode_a33261e7ae7ff313fe71885a887abf8c7}{value}} << std::endl;}
\DoxyCodeLine{263     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{264       ostr << \textcolor{stringliteral}{"{}feature("{}} << node-\/>\mbox{\hyperlink{classDecisionNode_a4e872cb5e21b8b26bb122bfd8d23d878}{feature}} << \textcolor{stringliteral}{"{}) threshold("{}} << node-\/>\mbox{\hyperlink{classDecisionNode_a3c647d210ebc81ea45138d95b4ad759b}{threshold}} << \textcolor{stringliteral}{"{})"{}} << \mbox{\hyperlink{DecisionTree_8h_a8924d32b66e3d6d5ad60477dbb332eb4}{measure\_to\_name}}(\mbox{\hyperlink{classDecisionTree_ac63504a08dc5485319f740609dff4604}{\_decision\_method}}) << \textcolor{stringliteral}{"{} = "{}} << node-\/>\mbox{\hyperlink{classDecisionNode_a98a2a9c54818c864dea1e8b7f4dc2153}{information\_gain}} << std::endl;}
\DoxyCodeLine{265       \textcolor{keywordflow}{if}(node-\/>\mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}}) \{}
\DoxyCodeLine{266         \mbox{\hyperlink{classDecisionTree_adb478af2bbf745ff208a4e666ef2b957}{render\_node}}(}
\DoxyCodeLine{267         ostr,}
\DoxyCodeLine{268         node-\/>\mbox{\hyperlink{classDecisionNode_aa8ff3eafda21da952e69bb1774909b15}{left}},}
\DoxyCodeLine{269         (\textcolor{stringliteral}{"{}L (x\_"{}} + std::to\_string(node-\/>\mbox{\hyperlink{classDecisionNode_a4e872cb5e21b8b26bb122bfd8d23d878}{feature}}) + \textcolor{stringliteral}{"{} <= "{}} + std::to\_string(node-\/>\mbox{\hyperlink{classDecisionNode_a3c647d210ebc81ea45138d95b4ad759b}{threshold}}) + \textcolor{stringliteral}{"{}): "{}}).c\_str(),}
\DoxyCodeLine{270         depth + 1);}
\DoxyCodeLine{271       \}}
\DoxyCodeLine{272       \textcolor{keywordflow}{if}(node-\/>\mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}}) \{}
\DoxyCodeLine{273         \mbox{\hyperlink{classDecisionTree_adb478af2bbf745ff208a4e666ef2b957}{render\_node}}(}
\DoxyCodeLine{274         ostr,}
\DoxyCodeLine{275         node-\/>\mbox{\hyperlink{classDecisionNode_a0a0a2c5131fb90e486bf12b245048b9a}{right}},}
\DoxyCodeLine{276         (\textcolor{stringliteral}{"{}R (x\_"{}} + std::to\_string(node-\/>\mbox{\hyperlink{classDecisionNode_a4e872cb5e21b8b26bb122bfd8d23d878}{feature}}) + \textcolor{stringliteral}{"{} > "{}} + std::to\_string(node-\/>\mbox{\hyperlink{classDecisionNode_a3c647d210ebc81ea45138d95b4ad759b}{threshold}}) + \textcolor{stringliteral}{"{}): "{}}).c\_str(),}
\DoxyCodeLine{277         depth + 1);}
\DoxyCodeLine{278       \}}
\DoxyCodeLine{279     \}}
\DoxyCodeLine{280   \}}
\DoxyCodeLine{281 }
\DoxyCodeLine{282 \textcolor{keyword}{public}:}
\DoxyCodeLine{283   \mbox{\hyperlink{classDecisionNode}{DecisionNode}}* \mbox{\hyperlink{classDecisionTree_a569b48c520eb5b72a857170fccc791af}{GetRootNode}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classDecisionTree_af11dfd0fec8b8c40236b072fd43c10e6}{base\_node}}; \}}
\DoxyCodeLine{290   \textcolor{keywordtype}{void} \mbox{\hyperlink{classDecisionTree_ac4a9745f215b98d1d1e99bfada4f892d}{fit}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& X, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& y)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{291     \mbox{\hyperlink{classDecisionTree_af11dfd0fec8b8c40236b072fd43c10e6}{base\_node}} = (\mbox{\hyperlink{classDecisionNode}{DecisionNode}}*)malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classDecisionNode}{DecisionNode}}));}
\DoxyCodeLine{292     \mbox{\hyperlink{classDecisionTree_af11dfd0fec8b8c40236b072fd43c10e6}{base\_node}} = \mbox{\hyperlink{classDecisionTree_a821f49ab54e910f33941360a891b67fc}{build\_tree}}(X, y, 0);}
\DoxyCodeLine{293   \}}
\DoxyCodeLine{294 }
\DoxyCodeLine{299   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classDecisionTree_a5be795faaf93df472927196e01b6e505}{predict}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& X)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{300     \textcolor{keyword}{auto} out = \mbox{\hyperlink{numerics_2utils_8h_af5994908a659705a385de5bee89039fc}{zeros}}(X.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}(), 1);}
\DoxyCodeLine{301     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < X.\mbox{\hyperlink{classMatrix_a5330adf02b284293259eb9f7c9acaa99}{rows}}(); ++i) \{ out(i, 0) = \mbox{\hyperlink{classDecisionTree_ad6d9caca64c5ff9d73e710e86b52ed46}{\_predict}}(X.\mbox{\hyperlink{classMatrix_a74deba042f505ff0640028b07c20778e}{GetSlice}}(i), \mbox{\hyperlink{classDecisionTree_af11dfd0fec8b8c40236b072fd43c10e6}{base\_node}}); \}}
\DoxyCodeLine{302     \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{303   \}}
\DoxyCodeLine{304 }
\DoxyCodeLine{309   \mbox{\hyperlink{classMatrix}{Matrix<double>}} \mbox{\hyperlink{classDecisionTree_a8a6df0f826c735c1bf8cd3af1d9b0615}{transform}}(\textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& in)\textcolor{keyword}{ override }\{ \textcolor{keywordflow}{return} in; \};}
\DoxyCodeLine{310 }
\DoxyCodeLine{311   \textcolor{keyword}{friend} std::ostream\& \mbox{\hyperlink{classDecisionTree_a35aa0df69484f7d6194caef5b61219f6}{operator<<}}(std::ostream\& ostr, \textcolor{keyword}{const} \mbox{\hyperlink{classDecisionTree}{DecisionTree}}\& tree) \{}
\DoxyCodeLine{312     ostr.precision(17);}
\DoxyCodeLine{313     tree.\mbox{\hyperlink{classDecisionTree_adb478af2bbf745ff208a4e666ef2b957}{render\_node}}(ostr, tree.\mbox{\hyperlink{classDecisionTree_af11dfd0fec8b8c40236b072fd43c10e6}{base\_node}}, \textcolor{stringliteral}{"{}root: "{}}, 0);}
\DoxyCodeLine{314     \textcolor{keywordflow}{return} ostr;}
\DoxyCodeLine{315   \}}
\DoxyCodeLine{316 \};}

\end{DoxyCode}

\hypertarget{odeTrapez_8h_source}{}\doxysection{ode\+Trapez.\+h}
\label{odeTrapez_8h_source}\index{include/math/numerics/ode/odeTrapez.h@{include/math/numerics/ode/odeTrapez.h}}
\mbox{\hyperlink{odeTrapez_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}../lin\_alg/newton.h"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}../utils.h"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{ode_2ode_8h}{ode.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{27 \mbox{\hyperlink{structODEResult}{ODEResult}}}
\DoxyCodeLine{28 \mbox{\hyperlink{odeTrapez_8h_ace7f91e7f2dd579ff2f0e80a193825c5}{ODETrapez}}(\textcolor{keyword}{const} \mbox{\hyperlink{ode_2ode_8h_ad676feada87db8725ebe89248f5f3379}{ODE}}\& fun, \textcolor{keyword}{const} std::vector<double>\& tInterval, \textcolor{keyword}{const} \mbox{\hyperlink{classMatrix}{Matrix<double>}}\& y0, \textcolor{keyword}{const} \mbox{\hyperlink{structODEOption}{ODEOption}}\& option) \{}
\DoxyCodeLine{29     \textcolor{keywordtype}{size\_t} dim       = tInterval.size();}
\DoxyCodeLine{30     \textcolor{keywordtype}{size\_t} elem\_size = y0.\mbox{\hyperlink{classMatrix_a710d9b6934a24229fe06789f65ed0571}{columns}}();}
\DoxyCodeLine{31     \textcolor{keyword}{auto} h           = option.\mbox{\hyperlink{structODEOption_a4d1ab902dfbb3f19b3ef2fa219a76303}{h}};}
\DoxyCodeLine{32     \textcolor{keyword}{auto} TOL         = option.\mbox{\hyperlink{structODEOption_a33c4d75068cc55a3fcc6b15c79523483}{TOL}};}
\DoxyCodeLine{33     \textcolor{keyword}{auto} maxIter     = option.\mbox{\hyperlink{structODEOption_a45abb7aa0806c54ed678f2a7d9cad631}{maxIter}};}
\DoxyCodeLine{34     \textcolor{keyword}{auto} Jac         = option.\mbox{\hyperlink{structODEOption_a99dbd698766a95bb8a9cf0f2e28d7816}{Jac}};}
\DoxyCodeLine{35     \textcolor{keywordflow}{if}(h == 0) \{ h = (tInterval[dim -\/ 1] -\/ tInterval[0]) / 1000.0; \}}
\DoxyCodeLine{36     \textcolor{keywordtype}{int} n = int((tInterval[dim -\/ 1] -\/ tInterval[0]) / h) + 1;}
\DoxyCodeLine{37 }
\DoxyCodeLine{38     \textcolor{keyword}{auto} t    = \mbox{\hyperlink{classMatrix}{Matrix<double>}}(0, n, 1, 1);}
\DoxyCodeLine{39     \textcolor{keyword}{auto} iter = \mbox{\hyperlink{classMatrix}{Matrix<int>}}(0, n, 1);}
\DoxyCodeLine{40     \textcolor{keyword}{auto} y    = \mbox{\hyperlink{utils_8cpp_a4af1fa738f95edd689ad5c984dc5fe7a}{zeros}}(n, elem\_size);}
\DoxyCodeLine{41 }
\DoxyCodeLine{42     t(0, 0) = tInterval[0];}
\DoxyCodeLine{43     y.SetRow(0, y0);}
\DoxyCodeLine{44     \textcolor{keyword}{auto} E = \mbox{\hyperlink{utils_8cpp_ab7da25ca0263921573b11a2425ce061c}{eye}}(elem\_size);}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 1; i < n; ++i) \{}
\DoxyCodeLine{47         \textcolor{keyword}{auto} y\_act    = y(i -\/ 1).Transpose();}
\DoxyCodeLine{48         t(i, 0)       = t(i -\/ 1, 0) + h;}
\DoxyCodeLine{49         \textcolor{keywordtype}{int} k         = 0;}
\DoxyCodeLine{50         \textcolor{keyword}{auto} delta    = \mbox{\hyperlink{utils_8cpp_a4777e8a26177a16a129f6f968b3ac12e}{ones}}(elem\_size);}
\DoxyCodeLine{51         \textcolor{keyword}{auto} prev\_fun = fun(t(i -\/ 1, 0), y\_act);}
\DoxyCodeLine{52 }
\DoxyCodeLine{53         \textcolor{keywordflow}{while}(\mbox{\hyperlink{utils_8cpp_aa1a08a76ee49f8a9717e4aa127984987}{norm}}(delta) > TOL \&\& k < maxIter) \{}
\DoxyCodeLine{54             \textcolor{keyword}{auto} current\_fun = fun(t(i, 0), y\_act);}
\DoxyCodeLine{55             \textcolor{keyword}{auto} F           = -\/1.0 * (y(i -\/ 1).Transpose() + h / 2 * (prev\_fun + current\_fun) -\/ y\_act);}
\DoxyCodeLine{56             \textcolor{keyword}{auto} J           = h / 2 * Jac(t(i, 0), y\_act) -\/ E;}
\DoxyCodeLine{57 }
\DoxyCodeLine{58             delta = \mbox{\hyperlink{gaussSeidel_8h_a7bb1e3f545d858ee2a450500c711f471}{gaussSeidel}}(J, F);}
\DoxyCodeLine{59             y\_act += delta;}
\DoxyCodeLine{60             k++;}
\DoxyCodeLine{61         \}}
\DoxyCodeLine{62         \textcolor{keywordflow}{if}(k == maxIter) \{}
\DoxyCodeLine{63             \textcolor{comment}{// err max iteration reached, did not convert.}}
\DoxyCodeLine{64         \}}
\DoxyCodeLine{65         iter(i, 0) = k;}
\DoxyCodeLine{66         y.SetRow(i, y\_act);}
\DoxyCodeLine{67     \}}
\DoxyCodeLine{68     \textcolor{keywordflow}{return} \{ y, t, iter \};}
\DoxyCodeLine{69 \}}
\DoxyCodeLine{70 }

\end{DoxyCode}
